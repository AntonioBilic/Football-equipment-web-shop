{% extends "web_shop/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            <!-- Bootstrap carousel for product images -->
            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="{{ product.image.url }}" class="d-block w-100" alt="{{ product.name }}">
                    </div>
                    {% for image in product_images %}
                    <div class="carousel-item">
                        <img src="{{ image.images.url }}" class="d-block w-100" alt="{{ product.name }}">
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="col-md-6">
            <h1>{{ product.name }}</h1>
            <p>{{ product.description }}</p>
            <h2>${{ product.price }}</h2>
            <p>Available Sizes:</p>
            <!-- Dropdown for sizes -->
            <div class="dropdown mb-3">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="sizeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Select Size
                </button>
                <ul class="dropdown-menu" aria-labelledby="sizeDropdown">
                    {% for size in all_sizes %}
                    <li><a class="dropdown-item" href="#">{{ size.size }}</a></li>
                    {% endfor %}
                </ul>
            </div>
            <a href="{% url 'add_to_order' product.id %}" class="btn btn-primary">Add to Cart</a>
            <a href="{% url 'add_to_wishlist' product.id %}" class="btn btn-secondary">Add to Wishlist</a>

        </div>
    </div>
    <div class="mt-5">
        <h2>Reviews</h2>
        <!-- Display reviews -->
        <div class="reviews">
            {% for review in reviews %}
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ review.user.username }}</h5>
                    <p class="card-text">{{ review.review }}</p>
                    <p class="card-text"><strong>Rating: </strong>{{ review.get_rating_display }}</p>
                    <p class="card-text"><small class="text-muted">{{ review.date }}</small></p>
                </div>
            </div>
            {% endfor %}
        </div>
        <!-- Add review section -->
        <div class="add-review mt-5">
            <h3>Leave a Review</h3>
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                <div class="mb-3">
                    <label for="review" class="form-label">Review</label>
                    {{ review_form.review|as_crispy_field }}
                </div>
                <div class="mb-3">
                    <label for="rating" class="form-label">Rating</label>
                    {{ review_form.rating|as_crispy_field }}
                </div>
                <button type="submit" class="btn btn-primary">Submit Review</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
{% endblock %}
